#!/usr/bin/env escript
%% -*- erlang -*-
%%! -pa %NEPTUNE_EBINDIR%

-define(COMMAND_NAME, "neptune").

main(CmdLine) ->
    Args = neptune_args:parse(CmdLine),
    Pars = Args#{sysconfdir => <<"%NEPTUNE_SYSCONFDIR%">>},
    case Args of
	#{help := null} ->
	    ok = usage(),
	    halt(0);
	#{version := null} ->
	    ok = version(),
	    halt(0);
	#{type := <<"release">>} ->
	    case neptune_rel:create(Pars) of
		ok ->
		    halt(0);
		{error, Reason} ->
		    ok = reason(Reason),
		    halt(1)
	    end;
	#{} ->
	    case neptune_app:create(Pars#{type => <<"application">>}) of
		ok ->
		    halt(0);
		{error, Reason} ->
		    ok = reason(Reason),
		    halt(1)
	    end
    end.

usage() ->
    ok = io:format("~s Name~n", [?COMMAND_NAME]),
    ok = io:format("~s [--help]~n", [?COMMAND_NAME]),
    Format = "see manual page for ~s(1) for more details~n",
    ok = io:format(Format, [?COMMAND_NAME]).

version() ->
    ok = io:format("~s ~s~n", [?COMMAND_NAME, "%PACKAGE_VERSION%"]).

reason(Reason) ->
    Format = "Failed to create because ~s.~n",
    ok = io:format(Format, [Reason]),
    ok = usage().
