AT_INIT
AT_COLOR_TESTS

m4_define([DIALYZER_CMD], [[set -x
export dialyzer_runcmd="${DIALYZER} \
  -Wno_behaviours -Wno_fail_call \
  --plts ${abs_top_builddir}/tests/%LC_PACKAGE_NAME%.plt \
  -- ${abs_top_srcdir}/src/*.erl"
]])

m4_define([COMPILE_EUNIT], [[set -x
mkdir -pv ${abs_top_builddir}/src
${ERLC} -DTEST -I${abs_top_srcdir}/include -o ${abs_top_builddir}/src $1
cd ${abs_top_builddir} && ln -s .libs priv && cd -
]]).

m4_define([EUNIT_CLEANUP], [[set -x
rm ${abs_top_builddir}/src/$1.beam
rm priv
]]).

m4_define([APP_TEST_SETUP], [[set -x
if test "x${AUTOTEST_PATH}" == "x${at_testdir}"; then
  mkdir -pv ${abs_top_builddir}/bin
  sed -e s#%%UC_PACKAGE_NAME%_EBINDIR%#${abs_top_builddir}/ebin#g \
      -e s#%%UC_PACKAGE_NAME%_SYSCONFDIR%#${abs_top_builddir}#g \
      -e s#%PACKAGE_VERSION%#${PACKAGE_VERSION}#g \
    ${abs_top_srcdir}/bin/%LC_PACKAGE_NAME%.in > ${abs_top_builddir}/bin/%LC_PACKAGE_NAME%
  chmod +x ${abs_top_builddir}/bin/%LC_PACKAGE_NAME%
fi
mkdir -p ${abs_top_srcdir}/priv && \
  cd ${abs_top_srcdir}/priv && \
  ln -s ${abs_top_srcdir}/.libs/lib%LC_PACKAGE_NAME%_nif.so . && cd -
PATH=${abs_top_builddir}/bin:${PATH} export PATH]]).

m4_define([APP_TEST_CLEANUP], [[set -x
if test "x${AUTOTEST_PATH}" == "x${at_testdir}"; then
  rm ${abs_top_builddir}/bin/%LC_PACKAGE_NAME%
fi
rm -rf ${abs_top_srcdir}/priv
]]).

m4_define([CT_RUN], [[set -x
export ct_runcmd="${CT_RUN} \
  -include ${abs_top_srcdir}/include ${abs_top_srcdir}/src \
  -pa ${abs_top_builddir}/ebin \
  -dir ${abs_top_srcdir}/tests"
]])
