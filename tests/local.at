AT_INIT
AT_COLOR_TESTS

m4_define([DIALYZER_RUN], [[set -x
${DIALYZER} -Wno_behaviours -Wno_fail_call \
  --plts ${abs_top_builddir}/tests/neptune.plt \
  -- ${abs_top_srcdir}/src/*.[eh]rl
]])

m4_define([COMPILE_EUNIT], [[set -x
${ERLC} -DTEST -I${abs_top_srcdir}/include -o ${abs_top_builddir}/src $1
]]).

m4_define([NEPTUNE_TEST], [[set -x
if test "x${AUTOTEST_PATH}" == "x${at_testdir}"; then
  sed -e s#ebin#${abs_top_builddir}/ebin#g \
    ${abs_top_builddir}/bin/neptune > ${abs_top_builddir}/bin/neptune_test
  chmod +x ${abs_top_builddir}/bin/neptune_test
else
  sed -e s#ebin#${DESTDIR}${neptune_ebindir}#g \
    ${abs_top_builddir}/bin/neptune > ${DESTDIR}${prefix}/bin/neptune_test
  chmod +x ${DESTDIR}${prefix}/bin/neptune_test
fi
mkdir -p ${abs_top_srcdir}/priv && \
  cd ${abs_top_srcdir}/priv && \
  ln -s ${abs_top_srcdir}/c_src/.libs/libneptune_nif.so . && cd -
PATH=${abs_top_builddir}/bin:${PATH} export PATH]]).

m4_define([NEPTUNE_CLEANUP], [[set -x
rm ${abs_top_builddir}/bin/neptune_test
rm -rf ${abs_top_srcdir}/priv
]]).
